<ion-header>
  <ion-grid text-center class="grid-tabs-splash">
    <ion-row align-items-end>
      <a ion-col *ngFor="let category of categories" [ngClass]="{ 'active_cat': isSelectedCategory(category) }" (click)="selectCategory(category)">
        <p><img [src]="category.image_url"></p>
        <p class="font-65 text-white">{{ category.name }}</p>
      </a>
    </ion-row>
  </ion-grid>
  <ion-segment text-uppercase>
    <ion-segment-button value="alloffers">
      All offers
    </ion-segment-button>
    <ion-segment-button value="new">
      New
    </ion-segment-button>
    <ion-segment-button value="monthly">
      Monthly
    </ion-segment-button>
    <ion-segment-button value="cheer">
      Featured
    </ion-segment-button>
  </ion-segment>
</ion-header>

<ion-content no-bounce class="padding-no">
  <ion-item class="block-search" no-lines padding-left padding-right>
    <ion-searchbar round placeholder=""></ion-searchbar>
    <a (click)="toggleMap()" item-end text-center>
      <img *ngIf="!isMapVisible" src="assets/img/user_home/icon_pin.svg">
      <img *ngIf="isMapVisible" src="assets/img/user_home/icon_pin_hide.svg">
    </a>
    <a (click)="openPopover()" class="btn_search_settings"><img src="assets/img/user_home/icon_settings.svg"></a>
  </ion-item>

  <ion-list padding-left padding-right *ngIf="!isMapVisible" no-lines class="item-block-nau margin-top-10">
    <ion-item *ngFor="let company of companies" (click)="openPlace(company.id)">
      <ion-avatar item-start text-center>
        <img [src]="company.image_url">
        <span *ngIf="company.is_featured" text-uppercase class="bold font-12 text-FF5A00">Featured</span>
      </ion-avatar>
      <div>
        <ng-container *ngFor="let showStar of getStars(company.stars)">
          <ion-icon class="text-FEC282 font-12" name="{{ showStar ? 'star' : 'star-outline' }}"></ion-icon>
        </ng-container>
        <img src="assets/img/user_home/icon_small_user.svg"><span class="font-75">{{ company.testimonials_count }}</span>
        <img class="margin-left-10" src="assets/img/user_home/icon_small_arrow.svg">
        <span class="font-75"> {{ getDistance(company.latitude, company.longitude) }} m</span>
      </div>
      <div class="bold font-22 text-3E4B5D">{{ company.name }}
        <ion-icon class="font-75" name="ios-arrow-forward"></ion-icon>
      </div>
      <ng-container *ngFor="let category of company.categories">
        <span class="type-food font-75 text-3E4B5D">{{ category.name }}</span>
      </ng-container>
      <div margin-top class="text-828282 font-12 wrap text-overflow-35">{{ company. description }}</div>

      <img class="star_right" src="assets/img/place/icon_star.svg">

      <div item-end>
        <div class="num_right">
          <div class="font-36 text-FF5A00" text-center>
            {{ company. offers_count }}
          </div>
          <div class="font-10 text-828282">
            offers
          </div>
        </div>
      </div>
    </ion-item>

  </ion-list>

  <div *ngIf="isMapVisible">
    <agm-map class="card" *ngIf="mapCenter" [zoom]="15" [latitude]="mapCenter.lat" [longitude]="mapCenter.lng" [fitBounds]="mapBounds">
      <agm-marker *ngFor="let company of companies" [latitude]="company.latitude" [longitude]="company.longitude" [iconUrl]="'assets/img/places_pin.png'">
        <agm-info-window [disableAutoPan]="false">
          <div (click)="openPlace(company.id)" class='agm-info-window-content'>{{company.name}}
          </div>
        </agm-info-window>
      </agm-marker>
    </agm-map>
  </div>
</ion-content>
